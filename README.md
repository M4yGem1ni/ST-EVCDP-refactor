# ST-EVCDP 项目重构需求文档

## 1. 项目概述

### 1.1 项目背景
随着电动汽车的快速普及，充电需求的研究与分析在城市交通与能源管理中具有重要意义。本项目基于深圳电动汽车充电数据集，该数据集覆盖数万根公共充电桩，提供了充电桩在不同时间段的充电状态信息。

### 1.2 项目目标
通过数据预处理、数据统计分析、地图可视化等方式，计算描述性统计特征，分析电动汽车充电特征的时空规律。采用自主研发的深度学习模型对充电需求进行预测，并提供可视化分析结果。

## 2. 功能需求

### 2.1 数据预处理模块
- **数据清洗**：处理缺失值、异常值和重复数据
- **数据标准化**：对充电量、价格等数值进行归一化处理
- **时空特征提取**：提取时间周期性特征和空间邻接关系
- **数据分割**：按时间序列划分训练集、验证集和测试集

### 2.2 统计分析模块
- **描述性统计**：计算充电桩利用率、充电时长、充电量等基础统计指标
- **时间模式分析**：分析日内、周内、月内充电需求变化规律
- **空间分布分析**：分析不同区域充电桩的利用率差异
- **相关性分析**：分析价格、天气、位置等因素对充电需求的影响

### 2.3 地图可视化模块
- **充电桩分布图**：在地图上展示充电桩的空间分布
- **热力图**：显示不同时间段、不同区域的充电需求热度
- **动态可视化**：展示充电需求的时空演化过程
- **交互式查询**：支持用户选择时间范围和区域进行查询

### 2.4 机器学习模块

#### 2.4.1 聚类分析
- **时间聚类**：对充电行为的时间模式进行聚类
- **空间聚类**：对充电桩进行区域聚类
- **用户行为聚类**：识别不同类型的充电用户群体

#### 2.4.2 预测模型
- **自主研发模型架构**：
  - **PAG (Physics-informed Attention-based Graph) 模型**
  - **物理信息引导的元学习框架**
  - **图注意力网络 + LSTM混合架构**

#### 2.4.3 基线模型对比
- LSTM模型
- GCN-LSTM模型
- Transformer模型
- 传统时间序列模型（ARIMA等）

## 3. 自主研发模型需求

### 3.1 模型架构设计

#### 3.1.1 PAG模型核心组件
```
PAG模型 = 图注意力层 + 时序编码器 + 物理约束层 + 预测层
```

**具体需求**：
- **图注意力机制**：学习充电桩之间的空间依赖关系
- **时序编码器**：提取历史充电序列的时间模式
- **物理约束层**：融入价格弹性等经济学原理
- **多头注意力**：同时关注不同类型的时空特征

#### 3.1.2 物理信息引导机制
- **价格弹性建模**：基于经济学理论的需求-价格关系
- **容量约束**：考虑充电桩的物理容量限制
- **距离衰减**：建模空间距离对需求的影响
- **时间周期性**：融入日、周、季节性规律

### 3.2 模型训练需求

#### 3.2.1 元学习框架
- **任务定义**：将不同价格弹性系数下的预测作为不同任务
- **快速适应**：模型能快速适应新的市场条件
- **迁移学习**：支持跨区域、跨时间的模型迁移

#### 3.2.2 训练策略
- **两阶段训练**：
  1. 物理信息引导的预训练
  2. 数据驱动的微调
- **损失函数设计**：物理约束损失 + 预测损失
- **正则化**：防止过拟合，提高泛化能力

### 3.3 模型评估需求
- **预测精度指标**：MSE、RMSE、MAPE、MAE、R²
- **物理一致性**：验证模型是否符合经济学原理
- **鲁棒性测试**：在不同条件下的模型稳定性
- **可解释性分析**：模型决策的可解释性

## 4. 技术需求

### 4.1 开发环境
- **编程语言**：Python 3.8+
- **深度学习框架**：PyTorch 1.12+
- **数据处理**：Pandas, NumPy
- **可视化**：Matplotlib, Seaborn, Plotly
- **地图可视化**：Folium, Geopandas

### 4.2 计算资源
- **GPU**：NVIDIA GPU (8GB+ 显存)
- **内存**：16GB+ RAM
- **存储**：100GB+ 可用空间

### 4.3 数据格式
- **输入数据**：CSV格式的时序数据
- **空间数据**：邻接矩阵、地理坐标
- **输出结果**：JSON格式的预测结果和可视化数据

## 5. 系统架构需求

### 5.1 模块化设计
```
ST-EVCDP/
├── data/                   # 数据模块
│   ├── preprocessing.py    # 数据预处理
│   ├── loader.py          # 数据加载器
│   └── utils.py           # 数据工具函数
├── models/                 # 模型模块
│   ├── pag.py             # PAG模型实现
│   ├── baselines.py       # 基线模型
│   └── meta_learning.py   # 元学习框架
├── analysis/              # 分析模块
│   ├── statistics.py      # 统计分析
│   ├── clustering.py      # 聚类分析
│   └── correlation.py     # 相关性分析
├── visualization/         # 可视化模块
│   ├── maps.py           # 地图可视化
│   ├── plots.py          # 统计图表
│   └── interactive.py    # 交互式可视化
├── evaluation/            # 评估模块
│   ├── metrics.py        # 评估指标
│   └── validation.py     # 模型验证
└── main.py               # 主程序入口
```

### 5.2 配置管理
- **超参数配置**：YAML格式的配置文件
- **模型配置**：支持不同模型的灵活配置
- **实验管理**：记录实验参数和结果

## 6. 性能需求

### 6.1 预测精度要求
- **MAPE < 15%**：平均绝对百分比误差小于15%
- **R² > 0.8**：决定系数大于0.8
- **实时预测**：单次预测时间 < 1秒

### 6.2 系统性能要求
- **数据处理速度**：支持百万级数据点的快速处理
- **可视化响应**：图表生成时间 < 5秒
- **内存效率**：合理的内存使用，避免内存溢出

## 7. 可扩展性需求

### 7.1 模型扩展
- **支持新模型**：便于集成新的预测模型
- **参数调优**：支持自动化超参数优化
- **多任务学习**：支持同时预测多个目标变量

### 7.2 数据扩展
- **多城市数据**：支持不同城市数据的接入
- **实时数据流**：支持实时数据的处理和预测
- **多模态数据**：支持天气、交通等外部数据的融合

## 8. 用户界面需求

### 8.1 命令行界面
- **简单易用**：提供清晰的命令行参数
- **进度显示**：显示训练和预测进度
- **日志记录**：详细的运行日志

### 8.2 可视化界面
- **交互式仪表板**：提供Web界面进行交互式分析
- **报告生成**：自动生成分析报告
- **结果导出**：支持多种格式的结果导出

## 9. 测试需求

### 9.1 单元测试
- **数据处理模块测试**
- **模型组件测试**
- **可视化功能测试**

### 9.2 集成测试
- **端到端流程测试**
- **性能压力测试**
- **异常情况处理测试**

## 10. 文档需求

### 10.1 技术文档
- **API文档**：详细的函数和类文档
- **模型说明**：模型原理和实现细节
- **使用指南**：完整的使用教程

### 10.2 研究文档
- **实验报告**：模型性能对比分析
- **案例研究**：实际应用案例分析
- **论文支撑**：支持学术论文发表的实验结果

这份需求文档为ST-EVCDP项目的重构提供了全面的指导，确保项目能够满足电动汽车充电需求分析的各项要求，并为后续的研究和应用奠定坚实基础。